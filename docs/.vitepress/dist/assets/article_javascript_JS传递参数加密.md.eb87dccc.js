import{_ as l,H as p,o,c as t,J as e,E as c,V as r,C as s,a as n}from"./chunks/framework.ed8632ae.js";const m=JSON.parse('{"title":"🐘 JS传递参数加密","description":"","frontmatter":{},"headers":[],"relativePath":"article/javascript/JS传递参数加密.md","filePath":"article/javascript/JS传递参数加密.md"}'),y={name:"article/javascript/JS传递参数加密.md"},D=r(`<h1 id="js传递参数加密" tabindex="-1">🐘 JS传递参数加密 <a class="header-anchor" href="#js传递参数加密" aria-label="Permalink to &quot;:elephant: JS传递参数加密&quot;">​</a></h1><blockquote><p>在日常开发学习中，肯定会或多或少用到参数加密，以下是我在工作中遇到的参数加密业务功能，一起看看吧....</p></blockquote><ol><li>uniapp参数加密(传输给后端参数加密) <ol><li>1.使用npm install crypto 下载加密所需文件</li><li>2.在项目根目录下创建一个utils文件夹，创建一个encryption.js文件写入如下代码块</li></ol></li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> CryptoJS </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">crypto-js</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">	</span><span style="color:#676E95;font-style:italic;">// Crypto加密方法封装</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> aesUtil </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;"> 	</span><span style="color:#676E95;font-style:italic;">// 加密函數</span></span>
<span class="line"><span style="color:#BABED8;"> 	</span><span style="color:#82AAFF;">encrypt</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">word</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">keyStr</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">word</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Object</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;"> 			</span><span style="color:#676E95;font-style:italic;">//JSON.stringify</span></span>
<span class="line"><span style="color:#F07178;"> 			</span><span style="color:#BABED8;">word</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">word</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">keyStr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">encryptedObj</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">AES</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encrypt</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">word</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;"> 			mode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">mode</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ECB</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;"> 			padding</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pad</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Pkcs7</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> )</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">encryptedObj</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;"> 	</span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;"> 	</span><span style="color:#676E95;font-style:italic;">// 解密函數</span></span>
<span class="line"><span style="color:#BABED8;"> 	</span><span style="color:#82AAFF;">decrypt</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">word</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">keyStr</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">keyStr</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decrypt</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">AES</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decrypt</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">word</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;"> 			mode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">mode</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ECB</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;"> 			padding</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pad</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ZeroPadding</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> )</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decString</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">decrypt</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;"> 		</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decString</span></span>
<span class="line"><span style="color:#F07178;"> 	</span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">module.exports={</span></span>
<span class="line"><span style="color:#BABED8;">	 aesUtil</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span></span></code></pre></div><ol start="3"><li>使用加密参数功能函数 <ol><li>在需要使用加密的页面引入encryption.js文件 <ol><li>import Encry from &#39;@/utils/encryption.js&#39;</li></ol></li><li>2.在使用的页面引入与后端约定的key(非常重要，可以挂载全局变量)，example: const key=&quot;cd10239350d94d639cba546a876c0daa&quot;</li></ol></li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">//  初始化自定义参数</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cd10239350d94d639cba546a876c0daa</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">// 前端与后端约定的共同协议密匙key</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> postData</span><span style="color:#89DDFF;">={</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">小邱</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">age</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">21</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">height</span><span style="color:#89DDFF;">:</span><span style="color:#F78C6C;">175</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">};</span></span>
<span class="line"><span style="color:#BABED8;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(Encry</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">aesUtil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encrypt</span><span style="color:#BABED8;">(postData</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;">key)</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">参数加密查看</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;"> console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(Encry</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">aesUtil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decrypt</span><span style="color:#BABED8;">(postData</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;">key)</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">参数解密查看</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;"> uni</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">request</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">url</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fdfsdf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> Encry</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">aesUtil</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encrypt</span><span style="color:#BABED8;">(postData</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> key)</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 请求参数加密</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">methods</span><span style="color:#89DDFF;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">header</span><span style="color:#89DDFF;">:{</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;font-style:italic;">// 配置请求头信息</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#F07178;">success</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><ol start="2"><li>解密后端返回参数 <ol><li>在utils文件夹内创建一个WXBizDataCrypt.js文件，写入以下代码</li></ol></li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> crypto </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">require</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">crypto</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">WXBizDataCrypt</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">appId</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">sessionKey</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">appId</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">sessionKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">sessionKey</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">WXBizDataCrypt</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decryptData</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">encryptedData</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">iv</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// base64 decode</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">sessionKey</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Buffer</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">sessionKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">encryptedData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Buffer</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">encryptedData</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">iv</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Buffer</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">iv</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">base64</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;font-style:italic;">// 解密</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decipher</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">crypto</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">createDecipheriv</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">aes-128-cbc</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">sessionKey</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">iv</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 设置自动 padding 为 true，删除填充补位</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">decipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">setAutoPadding</span><span style="color:#F07178;">(</span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decoded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">encryptedData</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">binary</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">decoded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decipher</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">final</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">decoded</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">decoded</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">err</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Illegal Buffer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">decoded</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">watermark</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">appid</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#BABED8;">appId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Illegal Buffer</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">decoded</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> WXBizDataCrypt</span></span></code></pre></div><ol start="2"><li>使用解密功能函数 <ol><li>在需要使用的页面引入该文件 <ol><li>import WXBizDataCrypt from &#39;@/utils/WXBizDataCrypt.js&#39;</li></ol></li><li>2.例如手机号授权的时候</li></ol></li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 1.首先通过uni.login获取到sessionKey并用变量保存</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 2.通过手机号授权获取到encryptedData和iv</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 3.接下来解密数据获取手机号</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">={</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">iv</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;">iv</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">encryptedData</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;">encryptedData</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">sessionKey</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;">sessionKey</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 使用解密获取数据 openId为小程序的openId,sessionKey是通过uni.login获取到的sessionkey;</span></span>
<span class="line"><span style="color:#BABED8;">    let pc</span><span style="color:#89DDFF;">=new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">WXBizDataCrypt</span><span style="color:#BABED8;">(openId</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;">sesssionKey)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 获取data的两个参数都是通过手机授权获取到的参数</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;">pc</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decryptData</span><span style="color:#BABED8;">(encryptedData</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;">iv)</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">    console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(data</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">phoneNumber</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">获取到的手机号码</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span></code></pre></div><ol start="3"><li>前端使用md5加密 <ol><li>首先下载md5加密 <ol><li>打开dos命令窗口 npm install js-md5 -D</li><li>在main.js文件里引入并挂载全局 <ol><li>mport Md5 from &#39;js-md5&#39;; // 引入</li><li>Vue.prototype.$md5=Md5;</li></ol></li><li>在需要使用md5加密的页面直接使用 <ol><li>postData是请求参数 时间戳 signKey 预定的一个密钥</li><li>let result=$md5(JSON.stringify(postData)+(newDate().valueOf()siginKey)</li><li>result就是md5加密后的数据</li></ol></li></ol></li></ol></li><li>4.原生HTML使用AES加密</li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://cdn.bootcdn.net/ajax/libs/crypto-js/4.0.0/crypto-js.min.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> aseKey </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">12345678</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">     </span><span style="color:#676E95;font-style:italic;">//秘钥必须为：8/16/32位</span></span>
<span class="line"><span style="color:#BABED8;">   </span><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> message </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">13785624612</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//加密</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> encrypt </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">AES</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">encrypt</span><span style="color:#BABED8;">(message</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#BABED8;">(aseKey)</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">mode</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ECB</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">padding</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pad</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Pkcs7</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(encrypt)</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//解密</span></span>
<span class="line"><span style="color:#C792EA;">var</span><span style="color:#BABED8;"> decrypt </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">AES</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">decrypt</span><span style="color:#BABED8;">(encrypt</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#BABED8;">(aseKey)</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">mode</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">mode</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">ECB</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">padding</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">pad</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Pkcs7</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#BABED8;">(CryptoJS</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">enc</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">Utf8)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(decrypt)</span><span style="color:#89DDFF;">;</span><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">//13785624612</span></span></code></pre></div><ol><li>原色JS使用MD5加密生成验签sign</li></ol><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://cdn.bootcdn.net/ajax/libs/blueimp-md5/2.19.0/js/md5.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">     </span><span style="color:#676E95;font-style:italic;">// data 为原始参数对象  key为MD5验签的Key</span></span>
<span class="line"><span style="color:#BABED8;">     </span><span style="color:#C792EA;">let</span><span style="color:#BABED8;"> sign</span><span style="color:#89DDFF;">=</span><span style="color:#82AAFF;">md5</span><span style="color:#BABED8;">(JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#BABED8;">(data) </span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;"> (</span><span style="color:#89DDFF;">new</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">valueOf</span><span style="color:#BABED8;">()) </span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fdfdffsdfsf</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">,</span></span></code></pre></div>`,14),F=s("br",null,null,-1),B=s("ul",null,[s("li",null,[n("好了，以上的总结就到此为止了，如果"),s("code",null,"有疑问可以不问"),n("也可以联系作者。咱们下期再见! Good bye! 🌸")])],-1);function i(A,E,d,C,f,u){const a=p("font");return o(),t("div",null,[D,e(a,{color:"#dd00dd"},{default:c(()=>[n("不想上图了，如有疑问咨询作者")]),_:1}),F,B])}const S=l(y,[["render",i]]);export{m as __pageData,S as default};
